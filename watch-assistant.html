<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Assistant | AuthenticWrist.com</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;1,400&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-chat: #1a1a24;
            --bg-user: #c4a35a;
            --bg-bot: #1e1e2a;
            --gold: #c4a35a;
            --gold-light: #d4b86a;
            --gold-dark: #a48940;
            --text-primary: #f5f5f5;
            --text-secondary: #a0a0a0;
            --text-muted: #666;
            --border: rgba(196, 163, 90, 0.2);
            --gradient-luxury: linear-gradient(135deg, #c4a35a 0%, #d4b86a 50%, #a48940 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
        }

        /* Demo page styling */
        .demo-page {
            padding: 60px 40px;
            max-width: 800px;
            margin: 0 auto;
            color: var(--text-primary);
        }

        .demo-page h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 20px;
        }

        .demo-page p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .demo-page .note {
            background: var(--bg-card);
            border-left: 3px solid var(--gold);
            padding: 20px;
            margin: 30px 0;
            font-size: 0.9rem;
        }

        /* Chat Widget Button */
        .chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: var(--gradient-luxury);
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(196, 163, 90, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 9998;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(196, 163, 90, 0.5);
        }

        .chat-button svg {
            width: 28px;
            height: 28px;
            fill: var(--bg-dark);
            transition: transform 0.3s ease;
        }

        .chat-button.open svg {
            transform: rotate(90deg);
        }

        /* Notification badge */
        .chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 22px;
            height: 22px;
            background: #e74c3c;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Chat Window */
        .chat-window {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 400px;
            height: 580px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.3s ease;
            z-index: 9999;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }

        .chat-window.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        /* Chat Header */
        .chat-header {
            background: var(--gradient-luxury);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            background: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .chat-header-info h3 {
            color: var(--bg-dark);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            font-weight: 500;
        }

        .chat-header-info p {
            color: rgba(0, 0, 0, 0.6);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-close {
            margin-left: auto;
            background: rgba(0, 0, 0, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .chat-close:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .chat-close svg {
            width: 16px;
            height: 16px;
            fill: var(--bg-dark);
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--bg-chat);
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .message {
            max-width: 85%;
            animation: messageIn 0.3s ease;
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            align-self: flex-start;
        }

        .message.user {
            align-self: flex-end;
        }

        .message-content {
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .message.bot .message-content {
            background: var(--bg-bot);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .message.user .message-content {
            background: var(--gradient-luxury);
            color: var(--bg-dark);
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 5px;
            padding: 0 5px;
        }

        .message.user .message-time {
            text-align: right;
        }

        /* Quick Replies */
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply {
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Raleway', sans-serif;
        }

        .quick-reply:hover {
            background: var(--gold);
            color: var(--bg-dark);
        }

        /* Product Card in Chat */
        .product-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
        }

        .product-card h4 {
            color: var(--gold);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .product-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .product-card .price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .product-card .current-price {
            color: var(--gold-light);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .product-card .original-price {
            color: var(--text-muted);
            text-decoration: line-through;
            font-size: 0.9rem;
        }

        .product-card .savings {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .product-card .shop-btn {
            display: block;
            text-align: center;
            background: var(--gradient-luxury);
            color: var(--bg-dark);
            padding: 10px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 1px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card .shop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(196, 163, 90, 0.3);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 14px 18px;
            background: var(--bg-bot);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            width: fit-content;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        /* Chat Input */
        .chat-input-container {
            padding: 15px 20px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-chat);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-family: 'Raleway', sans-serif;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .chat-input:focus {
            border-color: var(--gold);
        }

        .chat-send {
            width: 45px;
            height: 45px;
            background: var(--gradient-luxury);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .chat-send:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(196, 163, 90, 0.4);
        }

        .chat-send svg {
            width: 20px;
            height: 20px;
            fill: var(--bg-dark);
            margin-left: 2px;
        }

        /* Promo Code Style */
        .promo-code {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(196, 163, 90, 0.15);
            border: 1px dashed var(--gold);
            padding: 8px 14px;
            border-radius: 6px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .promo-code:hover {
            background: rgba(196, 163, 90, 0.25);
        }

        .promo-code code {
            color: var(--gold-light);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .promo-code .copy-icon {
            width: 14px;
            height: 14px;
            fill: var(--gold);
        }

        /* Mobile Responsive */
        @media (max-width: 500px) {
            .chat-window {
                width: calc(100% - 20px);
                height: calc(100% - 100px);
                bottom: 90px;
                right: 10px;
                border-radius: 12px;
            }

            .chat-button {
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
            }

            .demo-page {
                padding: 30px 20px;
            }

            .demo-page h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>

<!-- Demo Page Content -->
<div class="demo-page">
    <h1>‚åö Watch Assistant Widget</h1>
    <p>This is a demo page showing the AI Watch Assistant chat widget. Click the gold button in the bottom right corner to open the chat!</p>
    
    <div class="note">
        <strong>How to add to your site:</strong><br><br>
        Copy everything between <code>&lt;!-- CHAT WIDGET START --&gt;</code> and <code>&lt;!-- CHAT WIDGET END --&gt;</code> and paste it just before the closing <code>&lt;/body&gt;</code> tag on any page of your website.
    </div>

    <p>The assistant can help visitors with:</p>
    <p>‚úì Watch recommendations by budget<br>
    ‚úì Brand comparisons (Rolex vs Omega, etc.)<br>
    ‚úì Current deals and promo codes<br>
    ‚úì Grey market buying advice<br>
    ‚úì Investment potential questions<br>
    ‚úì Finding specific models</p>
</div>

<!-- CHAT WIDGET START -->

<!-- Chat Toggle Button -->
<button class="chat-button" id="chatToggle" onclick="toggleChat()">
    <span class="chat-badge" id="chatBadge">1</span>
    <svg viewBox="0 0 24 24" id="chatIcon">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
    </svg>
</button>

<!-- Chat Window -->
<div class="chat-window" id="chatWindow">
    <div class="chat-header">
        <div class="chat-avatar">‚åö</div>
        <div class="chat-header-info">
            <h3>Watch Concierge</h3>
            <p><span class="online-dot"></span> Online now</p>
        </div>
        <button class="chat-close" onclick="toggleChat()">
            <svg viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
    </div>

    <div class="chat-messages" id="chatMessages">
        <!-- Messages will be inserted here -->
    </div>

    <div class="chat-input-container">
        <input type="text" class="chat-input" id="chatInput" placeholder="Ask about watches..." onkeypress="handleKeyPress(event)">
        <button class="chat-send" onclick="sendMessage()">
            <svg viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
        </button>
    </div>
</div>

<script>
// Watch Assistant Knowledge Base
const watchKnowledge = {
    brands: {
        rolex: {
            name: "Rolex",
            tier: "Ultra Luxury",
            priceRange: "$7,000 - $400,000+",
            avgPrice: "$14,978",
            valueRetention: "98%",
            popular: ["Submariner", "Daytona", "GMT-Master II", "Datejust", "Day-Date"],
            tip: "Rolex rarely offers discounts. Best to buy from authorized dealers or trusted pre-owned sellers like WatchBox.",
            deals: "Check Chrono24 for pre-owned deals, often 10-15% below retail for unworn pieces."
        },
        omega: {
            name: "Omega",
            tier: "Luxury",
            priceRange: "$5,000 - $50,000+",
            valueRetention: "82%",
            popular: ["Speedmaster", "Seamaster", "Constellation", "Planet Ocean"],
            tip: "Grey market dealers like Jomashop offer Omega at 20-35% off retail!",
            deals: "Use code SDFLASH5 at Jomashop for $5 off, or find Speedmasters around $4,500 grey market vs $6,500 retail."
        },
        tagheuer: {
            name: "TAG Heuer",
            tier: "Premium",
            priceRange: "$1,500 - $30,000+",
            valueRetention: "65%",
            popular: ["Carrera", "Monaco", "Aquaracer", "Formula 1"],
            tip: "Excellent entry into Swiss luxury. Grey market saves 20-30%.",
            deals: "Jomashop has TAG Heuer Aquaracers starting around $1,200 (vs $1,800 retail)."
        },
        breitling: {
            name: "Breitling",
            tier: "Luxury",
            priceRange: "$3,500 - $50,000+",
            valueRetention: "70%",
            popular: ["Navitimer", "Avenger", "Superocean", "Chronomat"],
            tip: "Aviation heritage brand. Pre-owned market has great deals.",
            deals: "Breitling Avenger 43 at Jomashop: $2,595 (was $4,400) - 41% off!"
        },
        tudor: {
            name: "Tudor",
            tier: "Premium",
            priceRange: "$2,500 - $8,000+",
            valueRetention: "72%",
            popular: ["Black Bay", "Pelagos", "Ranger", "Royal"],
            tip: "Rolex's sister brand - same quality DNA at lower prices. Best value in Swiss watches!",
            deals: "Tudor Black Bay 58 around $3,200 grey market vs $3,900 retail."
        },
        cartier: {
            name: "Cartier",
            tier: "Ultra Luxury",
            priceRange: "$3,000 - $300,000+",
            valueRetention: "88%",
            popular: ["Santos", "Tank", "Ballon Bleu", "Panth√®re"],
            tip: "The 'Jeweler of Kings' - best for dress watches and unisex appeal.",
            deals: "Grey market Santos de Cartier around $5,500 vs $7,250 retail."
        },
        iwc: {
            name: "IWC Schaffhausen",
            tier: "Luxury",
            priceRange: "$5,000 - $150,000+",
            valueRetention: "75%",
            popular: ["Portugieser", "Pilot's Watch", "Big Pilot", "Aquatimer"],
            tip: "German precision meets Swiss craftsmanship. Excellent pilot watches.",
            deals: "Grey market savings of 15-25% on most models."
        },
        longines: {
            name: "Longines",
            tier: "Premium",
            priceRange: "$1,000 - $5,000+",
            valueRetention: "55%",
            popular: ["Master Collection", "HydroConquest", "Spirit", "Conquest"],
            tip: "Best value Swiss heritage brand. Nearly 200 years of excellence.",
            deals: "Up to 40% off at Jomashop. HydroConquest under $1,000!"
        },
        tissot: {
            name: "Tissot",
            tier: "Accessible Luxury",
            priceRange: "$300 - $2,000",
            valueRetention: "45%",
            popular: ["PRX", "Gentleman", "Le Locle", "Seastar"],
            tip: "Best entry-level Swiss brand under $1,000. The PRX is incredibly popular!",
            deals: "Tissot PRX Powermatic: $569 (was $725) - 22% off at Jomashop."
        },
        gucci: {
            name: "Gucci",
            tier: "Fashion",
            priceRange: "$500 - $5,000",
            valueRetention: "40%",
            popular: ["G-Timeless", "Dive", "Grip", "25H"],
            tip: "Fashion-forward Italian luxury. Buy for style, not investment.",
            deals: "Up to 50% off during sales at Nordstrom and department stores."
        },
        armani: {
            name: "Emporio Armani",
            tier: "Fashion",
            priceRange: "$150 - $800",
            valueRetention: "25%",
            popular: ["Classic", "Dress", "Renato"],
            tip: "Minimalist Italian design at accessible prices.",
            deals: "Up to 60% off during sales. Amazon often has great deals."
        },
        michaelkors: {
            name: "Michael Kors",
            tier: "Fashion",
            priceRange: "$100 - $500",
            valueRetention: "20%",
            popular: ["Runway", "Parker", "Bradshaw"],
            tip: "Trend-forward American glamour. Best discounts in fashion watches.",
            deals: "Up to 70% off! Check Nordstrom Rack and Amazon."
        }
    },
    
    retailers: {
        jomashop: {
            name: "Jomashop",
            type: "Grey Market",
            savings: "20-50% off retail",
            codes: ["SDFLASH5 ($5 off $30+)", "CART10 (10% select items)", "Newsletter: $20 off $250+"],
            note: "No manufacturer warranty, but Jomashop warranty included. Trusted since 1987."
        },
        chrono24: {
            name: "Chrono24",
            type: "Marketplace",
            savings: "Varies - negotiate!",
            codes: [],
            note: "World's largest watch marketplace. Buyer protection included. Great for pre-owned."
        },
        watchbox: {
            name: "WatchBox",
            type: "Pre-Owned Luxury",
            savings: "10-30% off retail",
            codes: [],
            note: "Certified pre-owned with warranty. Trade-in program available."
        },
        amazon: {
            name: "Amazon",
            type: "Retail",
            savings: "Varies",
            codes: ["Prime exclusive deals", "Subscribe & Save up to 10%"],
            note: "Good for fashion watches and some Swiss brands. Check seller ratings!"
        },
        nordstrom: {
            name: "Nordstrom",
            type: "Department Store",
            savings: "Up to 60% clearance",
            codes: ["Nordy Club points", "$40 credit card bonus"],
            note: "Great return policy. Authorized dealer for many brands."
        }
    },

    promoCodes: [
        { code: "SDFLASH5", store: "Jomashop", discount: "$5 off $30+" },
        { code: "CART10", store: "Jomashop", discount: "10% off select items" },
        { code: "Newsletter signup", store: "Jomashop", discount: "$20 off $250+" },
        { code: "Student discount", store: "Jomashop", discount: "$10 off $125+" }
    ]
};

// Chat State
let chatOpen = false;
let isTyping = false;
let conversationHistory = [];

// Toggle Chat
function toggleChat() {
    chatOpen = !chatOpen;
    const chatWindow = document.getElementById('chatWindow');
    const chatButton = document.getElementById('chatToggle');
    const badge = document.getElementById('chatBadge');
    
    chatWindow.classList.toggle('open', chatOpen);
    chatButton.classList.toggle('open', chatOpen);
    
    if (chatOpen && badge) {
        badge.style.display = 'none';
    }
    
    // Show welcome message on first open
    if (chatOpen && conversationHistory.length === 0) {
        showWelcomeMessage();
    }
}

// Welcome Message
function showWelcomeMessage() {
    const messages = document.getElementById('chatMessages');
    
    setTimeout(() => {
        addBotMessage(`Welcome to AuthenticWrist! üëã

I'm your personal watch concierge. I can help you find the perfect timepiece, discover deals, and answer any questions.

What are you looking for today?`);
        
        addQuickReplies([
            "Recommend a watch",
            "Best deals now",
            "Compare brands",
            "Promo codes"
        ]);
    }, 500);
}

// Add Bot Message
function addBotMessage(text, extras = null) {
    const messages = document.getElementById('chatMessages');
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message bot';
    
    let html = `
        <div class="message-content">${formatMessage(text)}</div>
        <div class="message-time">${time}</div>
    `;
    
    if (extras) {
        html += extras;
    }
    
    messageDiv.innerHTML = html;
    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
    
    conversationHistory.push({ role: 'bot', text: text });
}

// Add User Message
function addUserMessage(text) {
    const messages = document.getElementById('chatMessages');
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message user';
    messageDiv.innerHTML = `
        <div class="message-content">${text}</div>
        <div class="message-time">${time}</div>
    `;
    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
    
    conversationHistory.push({ role: 'user', text: text });
}

// Add Quick Replies
function addQuickReplies(replies) {
    const messages = document.getElementById('chatMessages');
    const lastMessage = messages.lastElementChild;
    
    const repliesDiv = document.createElement('div');
    repliesDiv.className = 'quick-replies';
    
    replies.forEach(reply => {
        const btn = document.createElement('button');
        btn.className = 'quick-reply';
        btn.textContent = reply;
        btn.onclick = () => {
            repliesDiv.remove();
            handleUserInput(reply);
        };
        repliesDiv.appendChild(btn);
    });
    
    lastMessage.appendChild(repliesDiv);
}

// Add Product Card
function addProductCard(product) {
    return `
        <div class="product-card">
            <h4>${product.name}</h4>
            <p>${product.description}</p>
            <div class="price">
                <span class="current-price">${product.price}</span>
                ${product.originalPrice ? `<span class="original-price">${product.originalPrice}</span>` : ''}
                ${product.savings ? `<span class="savings">${product.savings}</span>` : ''}
            </div>
            <a href="${product.link}" target="_blank" class="shop-btn">View Deal ‚Üí</a>
        </div>
    `;
}

// Format Message (convert line breaks, make links clickable)
function formatMessage(text) {
    return text
        .replace(/\n/g, '<br>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
}

// Show Typing Indicator
function showTyping() {
    const messages = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message bot';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
        <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
        </div>
    `;
    messages.appendChild(typingDiv);
    messages.scrollTop = messages.scrollHeight;
}

// Hide Typing Indicator
function hideTyping() {
    const typing = document.getElementById('typingIndicator');
    if (typing) typing.remove();
}

// Handle Key Press
function handleKeyPress(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}

// Send Message
function sendMessage() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    
    if (!text) return;
    
    input.value = '';
    handleUserInput(text);
}

// Handle User Input
function handleUserInput(text) {
    addUserMessage(text);
    showTyping();
    
    // Simulate thinking time
    setTimeout(() => {
        hideTyping();
        processQuery(text);
    }, 800 + Math.random() * 700);
}

// Process Query - Main AI Logic
function processQuery(query) {
    const q = query.toLowerCase();
    
    // Budget recommendations
    if (q.includes('under') || q.includes('budget') || q.includes('$')) {
        handleBudgetQuery(q);
    }
    // Brand specific
    else if (q.includes('rolex')) {
        handleBrandQuery('rolex');
    }
    else if (q.includes('omega')) {
        handleBrandQuery('omega');
    }
    else if (q.includes('tag') || q.includes('heuer')) {
        handleBrandQuery('tagheuer');
    }
    else if (q.includes('breitling')) {
        handleBrandQuery('breitling');
    }
    else if (q.includes('tudor')) {
        handleBrandQuery('tudor');
    }
    else if (q.includes('cartier')) {
        handleBrandQuery('cartier');
    }
    else if (q.includes('iwc')) {
        handleBrandQuery('iwc');
    }
    else if (q.includes('longines')) {
        handleBrandQuery('longines');
    }
    else if (q.includes('tissot')) {
        handleBrandQuery('tissot');
    }
    else if (q.includes('seiko')) {
        handleSeikoQuery();
    }
    // Comparisons
    else if (q.includes('vs') || q.includes('versus') || q.includes('compare') || q.includes('or')) {
        handleComparisonQuery(q);
    }
    // Deals
    else if (q.includes('deal') || q.includes('best deal') || q.includes('sale')) {
        handleDealsQuery();
    }
    // Promo codes
    else if (q.includes('promo') || q.includes('code') || q.includes('coupon') || q.includes('discount')) {
        handlePromoCodesQuery();
    }
    // Recommendations
    else if (q.includes('recommend') || q.includes('suggest') || q.includes('first watch') || q.includes('starter')) {
        handleRecommendationQuery();
    }
    // Grey market
    else if (q.includes('grey market') || q.includes('gray market') || q.includes('jomashop') || q.includes('legit')) {
        handleGreyMarketQuery();
    }
    // Investment
    else if (q.includes('invest') || q.includes('value') || q.includes('appreciate') || q.includes('hold value')) {
        handleInvestmentQuery();
    }
    // Dive watches
    else if (q.includes('dive') || q.includes('diving') || q.includes('water')) {
        handleDiveWatchQuery();
    }
    // Dress watches
    else if (q.includes('dress') || q.includes('formal') || q.includes('elegant')) {
        handleDressWatchQuery();
    }
    // Default
    else {
        handleDefaultQuery();
    }
}

// Budget Query Handler
function handleBudgetQuery(q) {
    let budget = 0;
    const match = q.match(/\$?([\d,]+)/);
    if (match) {
        budget = parseInt(match[1].replace(',', ''));
    }
    
    if (budget <= 500 || q.includes('under 500')) {
        addBotMessage(`Great budget to start! Here are my top picks under $500:

**Tissot PRX** (~$350-400) - The hottest watch in this range. '80s integrated bracelet design, Swiss quartz.

**Seiko Presage** (~$300-450) - Beautiful dials, automatic movement, incredible value.

**Orient Bambino** (~$150-200) - Best dress watch under $200, automatic movement.

**Citizen Eco-Drive** (~$200-400) - Solar powered, never needs a battery.

Would you like deals on any of these?`);
        addQuickReplies(["Tissot PRX deals", "Seiko options", "Show promo codes"]);
    }
    else if (budget <= 1000 || q.includes('under 1000') || q.includes('under 1,000')) {
        addBotMessage(`$1,000 opens up excellent Swiss options!

**Tissot PRX Powermatic 80** ($569 at Jomashop) - Automatic version, 80-hour power reserve. Currently 22% off!

**Hamilton Khaki Field** (~$500-700) - Military heritage, appears in 500+ Hollywood films.

**Seiko Prospex** (~$400-800) - Professional dive watches, Japanese excellence.

**Longines Conquest** (~$800-1,000 grey market) - True Swiss luxury at this price.

The Tissot PRX Powermatic is probably the best value right now.`);
        addQuickReplies(["Tissot PRX deal", "Hamilton options", "Compare these"]);
    }
    else if (budget <= 3000 || q.includes('under 3000') || q.includes('under 3,000')) {
        addBotMessage(`$3,000 is the sweet spot! You're entering true luxury territory:

**Tudor Black Bay 58** (~$3,200 grey market) - Rolex DNA at a fraction of the price. My top pick!

**Omega Seamaster 300** (~$2,800-3,500 grey market) - James Bond's choice.

**TAG Heuer Carrera** (~$2,500-3,000) - Motorsport heritage, beautiful chronographs.

**Longines Spirit** (~$2,000-2,500) - COSC certified, excellent finishing.

Tudor Black Bay offers the best long-term value with 72% value retention.`);
        addQuickReplies(["Tudor Black Bay info", "Omega deals", "TAG Heuer deals"]);
    }
    else if (budget <= 5000 || q.includes('under 5000') || q.includes('under 5,000')) {
        addBotMessage(`$5,000 unlocks serious luxury pieces:

**Omega Speedmaster Moonwatch** (~$4,500-5,000 grey market) - First watch on the moon. Icon status.

**Tudor Pelagos** (~$4,200) - 500m dive watch with titanium case.

**Breitling Avenger** (~$2,595-4,500 at Jomashop) - Up to 41% off right now!

**Cartier Santos** (~$5,500 grey market) - The first pilot's watch. Timeless elegance.

The Speedmaster is the most iconic choice - it has cult following status.`);
        addQuickReplies(["Speedmaster details", "Breitling deals", "Cartier info"]);
    }
    else {
        addBotMessage(`With $${budget.toLocaleString()}+, you're in premium territory! Consider:

**Rolex** (starting ~$7,000) - The ultimate status symbol with 98% value retention.

**Omega** ($5,000-15,000) - Speedmaster, Seamaster - iconic collections.

**Cartier** ($5,000-20,000) - Santos, Tank - jewelry-grade elegance.

**IWC** ($5,000-15,000) - Portugieser, Big Pilot - understated luxury.

For investment potential, Rolex and Patek Philippe lead the pack. Would you like specific model recommendations?`);
        addQuickReplies(["Rolex models", "Best investment watches", "Compare luxury brands"]);
    }
}

// Brand Query Handler
function handleBrandQuery(brandKey) {
    const brand = watchKnowledge.brands[brandKey];
    if (!brand) return handleDefaultQuery();
    
    addBotMessage(`**${brand.name}** - ${brand.tier}

**Price Range:** ${brand.priceRange}
**Value Retention:** ${brand.valueRetention}

**Popular Collections:**
${brand.popular.map(m => '‚Ä¢ ' + m).join('\n')}

**üí° Pro Tip:** ${brand.tip}

**üè∑Ô∏è Current Deals:** ${brand.deals}`);
    
    addQuickReplies([`${brand.name} deals`, "Compare to others", "Show promo codes"]);
}

// Seiko Query (special case)
function handleSeikoQuery() {
    addBotMessage(`**Seiko** - Japan's Horological Powerhouse üáØüáµ

Seiko is unique - they make everything from $50 watches to $50,000+ Grand Seiko!

**Best Value Picks:**
‚Ä¢ **Seiko 5** ($75-200) - Legendary automatic for beginners
‚Ä¢ **Presage** ($300-600) - Beautiful dials, cocktail time series
‚Ä¢ **Prospex** ($400-1,500) - Professional dive watches
‚Ä¢ **King Seiko** ($1,400-2,500) - Heritage dress watches

**Grand Seiko** ($3,500-50,000+) - Competes with Swiss luxury. The Spring Drive movement is revolutionary.

Seiko offers the best in-house movements at every price point!`);
    
    addQuickReplies(["Seiko 5 deals", "Grand Seiko info", "Seiko vs Swiss"]);
}

// Comparison Handler
function handleComparisonQuery(q) {
    if ((q.includes('rolex') && q.includes('omega')) || q.includes('rolex or omega') || q.includes('rolex vs omega')) {
        addBotMessage(`**Rolex vs Omega** - The Classic Debate!

| | **Rolex** | **Omega** |
|---|---|---|
| Price | $7,000-400,000+ | $5,000-50,000+ |
| Value Retention | 98% | 82% |
| Status | Ultimate prestige | Space & Bond heritage |
| Grey Market | Rarely discounted | 20-35% savings |
| Availability | Waitlists common | Readily available |

**My Take:** 
‚Ä¢ Choose **Rolex** for investment & status
‚Ä¢ Choose **Omega** for better initial value & equally impressive heritage

Omega Speedmaster was the first watch on the moon. Rolex has unmatched resale value. Both are excellent!`);
    }
    else if ((q.includes('tudor') && q.includes('omega')) || q.includes('tudor or omega') || q.includes('tudor vs omega')) {
        addBotMessage(`**Tudor vs Omega** - Great mid-luxury comparison!

| | **Tudor** | **Omega** |
|---|---|---|
| Price | $2,500-8,000 | $5,000-50,000+ |
| Value Retention | 72% | 82% |
| Heritage | Rolex sister brand | Moon landing legacy |
| Best For | Value seekers | History enthusiasts |

**My Take:**
‚Ä¢ **Tudor Black Bay** - Best value dive watch, Rolex DNA
‚Ä¢ **Omega Speedmaster** - More iconic, better brand recognition

If budget is $3,000-4,000, Tudor offers more watch for the money. If budget is $5,000+, Omega has the edge in prestige.`);
    }
    else {
        addBotMessage(`I'd be happy to compare watches! Which brands are you considering?

Popular comparisons:
‚Ä¢ Rolex vs Omega
‚Ä¢ Tudor vs Omega
‚Ä¢ TAG Heuer vs Breitling
‚Ä¢ Longines vs Tissot
‚Ä¢ Rolex vs Cartier`);
        addQuickReplies(["Rolex vs Omega", "Tudor vs Omega", "TAG vs Breitling"]);
    }
}

// Deals Handler
function handleDealsQuery() {
    addBotMessage(`üî• **Hot Deals Right Now:**

**Breitling Avenger 43** 
$2,595 (was $4,400) - **41% OFF** at Jomashop

**Breitling Superocean**
$3,450 (was $7,600) - **55% OFF**

**Tissot PRX Powermatic**
$569 (was $725) - **22% OFF**

**Baume & Mercier Linea**
$995 (was $4,950) - **80% OFF**

**Movado Museum Classic**
$209 (was $895) - **77% OFF**

These are verified grey market prices. Shall I show you promo codes for extra savings?`);
    
    addQuickReplies(["Show promo codes", "Breitling details", "More deals"]);
}

// Promo Codes Handler
function handlePromoCodesQuery() {
    addBotMessage(`üè∑Ô∏è **Active Promo Codes:**

**Jomashop:**`);
    
    // Add promo codes with copy functionality
    const messages = document.getElementById('chatMessages');
    const lastMessage = messages.lastElementChild;
    
    const promoHtml = `
        <div style="margin-top: 15px;">
            <div class="promo-code" onclick="copyCode('SDFLASH5')">
                <code>SDFLASH5</code> - $5 off $30+
                <svg class="copy-icon" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </div>
            <div class="promo-code" onclick="copyCode('CART10')">
                <code>CART10</code> - 10% off select items
                <svg class="copy-icon" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </div>
            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 12px;">
                üìß <strong>Newsletter signup:</strong> $20 off $250+<br>
                üéì <strong>Student discount:</strong> $10 off $125+
            </p>
            <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 10px;">
                ‚ö†Ô∏è Note: Codes typically excluded from Rolex & Omega
            </p>
        </div>
    `;
    
    lastMessage.querySelector('.message-content').innerHTML += promoHtml;
    addQuickReplies(["Best deals now", "Where to buy", "Grey market safe?"]);
}

// Copy Code Function
function copyCode(code) {
    navigator.clipboard.writeText(code).then(() => {
        // Show copied feedback
        const btn = event.target.closest('.promo-code');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<code style="color: #27ae60;">‚úì Copied!</code>';
        setTimeout(() => {
            btn.innerHTML = originalText;
        }, 1500);
    });
}

// Recommendation Handler
function handleRecommendationQuery() {
    addBotMessage(`I'd love to help find your perfect watch! Let me ask a few questions:

**What's your budget range?**`);
    
    addQuickReplies(["Under $500", "Under $1,000", "$1,000-3,000", "$3,000-5,000", "$5,000+"]);
}

// Grey Market Handler
function handleGreyMarketQuery() {
    addBotMessage(`**Grey Market Explained** üõí

Grey market dealers sell authentic watches from unauthorized sources (overstock, international dealers, etc.)

**Pros:**
‚úÖ 20-50% savings off retail
‚úÖ Brand new, authentic watches
‚úÖ Dealer warranty included
‚úÖ Trusted companies like Jomashop (since 1987)

**Cons:**
‚ùå No manufacturer warranty
‚ùå Can't use at brand boutiques for free service
‚ùå Some brands (Rolex) not available

**Is Jomashop legit?** Absolutely! They've been in business 35+ years with millions of satisfied customers. I recommend them for Omega, TAG Heuer, Breitling, and Longines.

For Rolex, stick to authorized dealers or certified pre-owned (Chrono24, WatchBox).`);
    
    addQuickReplies(["Jomashop deals", "Best grey market buys", "Certified pre-owned"]);
}

// Investment Handler
function handleInvestmentQuery() {
    addBotMessage(`**Watch Investment Guide** üìà

**Top Value Retention (5-year data):**
1. **Rolex** - 98% (some models appreciate!)
2. **Patek Philippe** - 95%+ (Nautilus doubled!)
3. **Audemars Piguet** - 92%
4. **Cartier** - 88%
5. **Omega** - 82%
6. **Tudor** - 72%
7. **TAG Heuer** - 65%

**Best Investment Picks:**
‚Ä¢ Rolex Submariner / GMT-Master II
‚Ä¢ Rolex Daytona (if you can get one)
‚Ä¢ Patek Philippe Nautilus
‚Ä¢ Omega Speedmaster (specific refs)

**Pro Tip:** Buy what you love first! Watches should bring joy. Investment potential is a bonus, not the goal.`);
    
    addQuickReplies(["Rolex availability", "Best under $10k", "Patek info"]);
}

// Dive Watch Handler
function handleDiveWatchQuery() {
    addBotMessage(`**Best Dive Watches** üåä

**Under $500:**
‚Ä¢ Seiko Prospex "Turtle" (~$350)
‚Ä¢ Orient Mako/Ray (~$200)

**$500-2,000:**
‚Ä¢ Tissot Seastar (~$500-700)
‚Ä¢ Longines HydroConquest (~$1,200)
‚Ä¢ Oris Aquis (~$1,800)

**$2,000-5,000:**
‚Ä¢ Tudor Black Bay (~$3,200)
‚Ä¢ Tudor Pelagos (~$4,200)
‚Ä¢ Omega Seamaster 300M (~$4,000)

**$5,000+:**
‚Ä¢ Rolex Submariner (~$9,000+)
‚Ä¢ Omega Planet Ocean (~$6,500)
‚Ä¢ Breitling Superocean (~$3,500-5,000)

The Tudor Black Bay 58 is my top recommendation - perfect 39mm size, 200m water resistance, and that Rolex heritage!`);
    
    addQuickReplies(["Tudor Black Bay deal", "Omega Seamaster", "Best under $1k"]);
}

// Dress Watch Handler
function handleDressWatchQuery() {
    addBotMessage(`**Best Dress Watches** üëî

**Under $500:**
‚Ä¢ Orient Bambino (~$150-200) - Best value!
‚Ä¢ Tissot Le Locle (~$400)
‚Ä¢ Seiko Presage (~$300-450)

**$500-2,000:**
‚Ä¢ Hamilton Jazzmaster (~$700-1,200)
‚Ä¢ Longines Master Collection (~$1,500)
‚Ä¢ Frederique Constant (~$800-1,500)

**$2,000-5,000:**
‚Ä¢ Omega De Ville (~$3,500)
‚Ä¢ IWC Portofino (~$4,500)
‚Ä¢ Cartier Tank Solo (~$2,500)

**$5,000+:**
‚Ä¢ Cartier Tank Fran√ßaise (~$5,500)
‚Ä¢ Jaeger-LeCoultre Reverso (~$8,000)
‚Ä¢ Patek Philippe Calatrava (~$20,000+)

For timeless elegance, you can't beat the **Cartier Tank** - invented in 1917 and still iconic!`);
    
    addQuickReplies(["Cartier Tank info", "Orient Bambino deal", "IWC options"]);
}

// Default Handler
function handleDefaultQuery() {
    addBotMessage(`I'm here to help with anything watch-related! 

I can assist with:
‚Ä¢ **Recommendations** by budget or style
‚Ä¢ **Brand comparisons** (Rolex vs Omega, etc.)
‚Ä¢ **Current deals** and where to buy
‚Ä¢ **Promo codes** for extra savings
‚Ä¢ **Grey market** advice
‚Ä¢ **Investment** potential

What would you like to know?`);
    
    addQuickReplies(["Recommend a watch", "Best deals", "Promo codes", "Compare brands"]);
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    // Pre-populate with welcome intent
});
</script>

<!-- CHAT WIDGET END -->

</body>
</html>
